# 코드 평가 에이전트

A comprehensive code quality evaluation tool for AutoBE-generated code.

## Table of Contents

- [Overview](#overview)
- [AutoBE Phases](#autobe-phases)
- [Installation](#installation)
- [Quick Start](#quick-start)
- [CLI Reference](#cli-reference)
- [Evaluation System](#evaluation-system)
- [Phase Details](#phase-details)
- [Scoring System](#scoring-system)
- [Output Reports](#output-reports)
- [Examples](#examples)
- [Troubleshooting](#troubleshooting)

---

## Overview

`@autobe/estimate` evaluates code generated by AutoBE across 5 phases that align with AutoBE's generation process. It detects common issues in LLM-generated code and provides actionable feedback.

---

## AutoBE Phases

AutoBE generates code in 5 phases. This tool evaluates each phase:

| Phase | AutoBE Step | What We Evaluate | Folder |
|-------|-------------|------------------|--------|
| 1. Requirements | Analyze | Documentation coverage | `docs/analysis/` |
| 2. Database | Database | Schema design quality | `prisma/schema/` |
| 3. API | Interface | Controller & DTO quality | `src/controllers/`, `src/api/structures/` |
| 4. Test | Test | Test coverage & quality | `test/features/api/` |
| 5. Implementation | Realize | Business logic quality | `src/providers/` |

---

## Installation

You'll need Node.js 18+ and pnpm 8+ installed.

```bash
# Clone the repository
git clone <repository-url>
cd autobe-project

# Install dependencies
pnpm install

# Navigate to estimate package
cd packages/estimate
```

---

## Quick Start

```bash
# Evaluate a project
pnpm start --input /path/to/project --output ./reports --verbose

# Example
pnpm start --input ~/autobe-examples/anthropic/claude-sonnet-4.5/todo --output ./reports --verbose
```

---

## CLI Reference

Basic syntax:

```bash
pnpm start --input <path> --output <path> [options]
```

Options:

| Option | Alias | Description | Required |
|--------|-------|-------------|----------|
| `--input` | `-i` | Project path to evaluate | Yes |
| `--output` | `-o` | Report output path | Yes |
| `--verbose` | `-v` | Show detailed logs | No |
| `--continue-on-gate-failure` | - | Continue even if Gate fails | No |

---

## Evaluation System

### Phase Flow

The evaluation starts with a Gate phase that must pass. If it fails, the total score is 0. The Gate runs three checks in sequence: Syntax Check, Type Check, and Prisma Validation.

Once the Gate passes, the scoring phases run. Requirements accounts for 20%, Database for 15%, API for 20%, Test for 20%, and Implementation for 25%. These combine into the total score, which ranges from 0 to 100.

### Grading Scale

| Grade | Score | Description |
|-------|-------|-------------|
| A | 90-100 | Excellent - Production ready |
| B | 80-89 | Good - Minor improvements needed |
| C | 70-79 | Average - Several issues to address |
| D | 60-69 | Below Average - Significant issues |
| F | 0-59 | Fail - Major issues or Gate failure |

---

## Phase Details

### Gate (Pass/Fail)

Must pass to continue evaluation. Failure = 0 total score.

| Evaluator | Checks | Failure Condition |
|-----------|--------|-------------------|
| SyntaxEvaluator | TypeScript syntax | Parse error |
| TypeEvaluator | Type correctness | `tsc --noEmit` fails |
| PrismaEvaluator | Schema validity | `prisma validate` fails |

### Requirements (20%)

This corresponds to AutoBE's Analyze phase.

| Evaluator | Checks |
|-----------|--------|
| RequirementsEvaluator | Documentation in `docs/analysis/` |

### Database (15%)

This corresponds to AutoBE's Database phase.

| Evaluator | Checks |
|-----------|--------|
| NamingEvaluator | Schema naming conventions |
| JsDocEvaluator | Schema documentation |

### API (20%)

This corresponds to AutoBE's Interface phase.

| Evaluator | Checks | Issues |
|-----------|--------|--------|
| NamingEvaluator | Naming conventions | N001, N002 |
| JsDocEvaluator | Documentation | J001, J002 |
| ComplexityEvaluator | Cyclomatic complexity | C001, C002 |
| ValidationEvaluator | `any` type usage | V001 |
| HallucinationEvaluator | Invalid imports | H001 |

### Test (20%)

This corresponds to AutoBE's Test phase.

| Evaluator | Checks | Notes |
|-----------|--------|-------|
| TestRunnerEvaluator | Test file existence | |
| SecurityEvaluator | Security patterns | Relaxed for test files |
| ErrorHandlingEvaluator | Error handling | E001, E002 |

### Implementation (25%)

This corresponds to AutoBE's Realize phase.

| Evaluator | Checks | Issues |
|-----------|--------|--------|
| ComplexityEvaluator | Function complexity | C001, C002 |
| DuplicationEvaluator | Duplicate code | D001 |
| SecurityEvaluator | Security vulnerabilities | S001-S005 |
| ErrorHandlingEvaluator | Error handling | E001, E002 |
| TodoEvaluator | TODO/FIXME comments | T001, T002 |
| IncompleteEvaluator | Unimplemented code | I001, I002 |

---

## Scoring System

### Severity Weights

| Severity | Weight | Description |
|----------|--------|-------------|
| Critical | -10 | Must fix before production |
| Warning | -3 | Should fix for quality |
| Suggestion | -1 | Optional improvement |

### Phase Score Formula

```
weightedIssues = (critical × 10) + (warning × 3) + (suggestion × 1)
phaseScore = max(0, 100 - (weightedIssues / totalFiles) × 10)
```

### Total Score Formula

```
totalScore = requirements × 0.2
           + database × 0.15
           + api × 0.2
           + test × 0.2
           + implementation × 0.25
```

---

## Output Reports

### Markdown Report (`estimate-report.md`)

Human-readable report with overall score and grade, phase-by-phase breakdown, issue explanations, and improvement suggestions.

### JSON Report (`estimate-report.json`)

Machine-readable for CI/CD integration:

```json
{
  "totalScore": 75,
  "grade": "C",
  "phases": {
    "gate": { "passed": true },
    "requirements": { "score": 100 },
    "database": { "score": 100 },
    "api": { "score": 95 },
    "test": { "score": 93 },
    "implementation": { "score": 11 }
  },
  "summary": {
    "criticalCount": 2,
    "warningCount": 82,
    "suggestionCount": 61
  }
}
```

---

## Examples

### Basic Evaluation

```bash
pnpm start -i ~/project -o ./reports -v
```

### Sample Output

```
Total Score: 75/100 (Grade: C)

Phase Scores:
─────────────────────────────────────────
   Gate:                    Pass
   Requirements (Analyze)   100/100
   DB Design (Database)     100/100
   API Design (Interface)   95/100
   Test (Test)              93/100
   Implementation (Realize) 11/100
      └─ 80 warnings detected
      └─ 80x Duplicate code block found

Critical Issues: 2
   • [S004] Use of eval() is dangerous
      → eval() can execute arbitrary code (security risk)

Warnings: 82
   • [D001] Duplicate code block (80x)
      → Extract common code into a shared function
```

### Compare Multiple Models

```bash
# Claude
pnpm start -i ~/autobe-examples/anthropic/claude-sonnet-4.5/todo -o ./reports/claude

# DeepSeek
pnpm start -i ~/autobe-examples/deepseek/deepseek-v3.1-terminus-exacto/todo -o ./reports/deepseek

# Gemini
pnpm start -i ~/autobe-examples/google/gemini-2.5-pro/todo -o ./reports/gemini
```

---

## Troubleshooting

### "No TypeScript files found"

Check if input path is correct. Verify project has AutoBE folder structure.

### Gate Fails

Run with `--continue-on-gate-failure` to see all issues. Check `tsc --noEmit` and `prisma validate` manually.

### Low Implementation Score

Usually caused by duplicate code detection. Review `D001` warnings and extract common code.

---

## Issue Reference

| Code | Severity | Description |
|------|----------|-------------|
| S001 | Critical | Hardcoded password |
| S002 | Critical | Hardcoded API key |
| S003 | Critical | Hardcoded secret |
| S004 | Critical | eval() usage |
| S005 | Warning | innerHTML (XSS risk) |
| C001 | Critical | Complexity > 20 |
| C002 | Warning | Complexity > 15 |
| N001 | Warning | Class not PascalCase |
| N002 | Warning | Interface not PascalCase |
| J001 | Suggestion | Class missing JSDoc |
| J002 | Suggestion | Interface missing JSDoc |
| D001 | Warning | Duplicate code block |
| E001 | Warning | Empty catch block |
| E002 | Warning | Promise without .catch() |
| V001 | Warning | any type parameter |
| H001 | Critical | Package not in package.json |
| T001 | Warning | TODO comment |
| T002 | Critical | FIXME comment |
| I001 | Critical | "not implemented" error |
| I002 | Critical | "implement this" comment |

---

## License

MIT
